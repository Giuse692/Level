
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caravan Leveler Pro 2026</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
        .container { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        
        /* Libellen Design */
        .libelle-box { width: 80%; height: 40px; border: 2px solid #333; border-radius: 20px; margin: 20px auto; position: relative; background: #ddd; overflow: hidden; }
        .markierung { position: absolute; left: 50%; top: 0; bottom: 0; width: 4px; background: rgba(0,0,0,0.2); transform: translateX(-50%); border-left: 2px solid black; border-right: 2px solid black; }
        .blase { position: absolute; top: 5px; width: 30px; height: 30px; background: #adff2f; border-radius: 50%; box-shadow: inset 0 0 10px rgba(0,0,0,0.3); transition: left 0.2s ease-out; }
        
        /* Wohnwagen Grundriss */
        #caravan-view { width: 150px; margin: 20px auto; position: relative; }
        .pfeil { font-size: 40px; position: absolute; display: none; font-weight: bold; }
        .pfeil-hoch { color: red; }
        .pfeil-ok { color: green; }

        button { background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h1>Caravan Leveler</h1>
    <button onclick="connectBLE()">Verbinden via Bluetooth</button>
    <p id="status">Nicht verbunden</p>

    <!-- Libelle Quer (Achse) -->
    <p>Quer (Links/Rechts)</p>
    <div class="libelle-box">
        <div class="markierung"></div>
        <div id="blase-quer" class="blase" style="left: 45%;"></div>
    </div>

    <!-- Libelle Längs (Deichsel) -->
    <p>Längs (Vorne/Hinten)</p>
    <div class="libelle-box">
        <div class="markierung"></div>
        <div id="blase-laengs" class="blase" style="left: 45%;"></div>
    </div>

    <!-- Visuelle Hilfe mit Pfeilen -->
    <div id="caravan-view">
        <img src="upload.wikimedia.org" width="100" alt="Caravan">
        <div id="pfeil-links" class="pfeil" style="left: -40px; top: 30px;">↑</div>
        <div id="pfeil-rechts" class="pfeil" style="right: -40px; top: 30px;">↑</div>
        <div id="pfeil-vorne" class="pfeil" style="left: 40px; top: -40px;">↑</div>
        <div id="pfeil-hinten" class="pfeil" style="left: 40px; top: 100px;">↓</div>
    </div>
</div>

<script>
    let bleChar;

    async function connectBLE() {
        try {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{ name: 'Wohnwagen-Leveler' }],
                optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
            });
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService('4fafc201-1fb5-459e-8fcc-c5c9c331914b');
            bleChar = await service.getCharacteristic('beb5483e-36e1-4688-b7f5-ea07361b26a8');
            
            bleChar.startNotifications();
            bleChar.addEventListener('characteristicvaluechanged', handleData);
            document.getElementById('status').innerText = "Verbunden!";
        } catch (e) { console.log(e); }
    }

    function handleData(event) {
        let value = new TextDecoder().decode(event.target.value);
        let parts = value.split(',');
        let x = parseFloat(parts[0]); // Längs
        let y = parseFloat(parts[1]); // Quer

        // Libellen bewegen (Begrenzung 0-90%)
        document.getElementById('blase-laengs').style.left = Math.min(Math.max(45 + (x * 4), 5), 85) + "%";
        document.getElementById('blase-quer').style.left = Math.min(Math.max(45 + (y * 4), 5), 85) + "%";

        // Pfeil-Logik (Toleranz 0.5 Grad)
        updatePfeil('pfeil-vorne', x < -0.5);
        updatePfeil('pfeil-hinten', x > 0.5);
        updatePfeil('pfeil-links', y < -0.5);
        updatePfeil('pfeil-rechts', y > 0.5);
    }

    function updatePfeil(id, show) {
        document.getElementById(id).style.display = show ? 'block' : 'none';
    }
</script>
</body>
</html>
